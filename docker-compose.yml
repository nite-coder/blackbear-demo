version: "3.5"
services:
  # worker
  worker:
    image: jasonsoft/starter:latest
    depends_on:
      - event
      - wallet
    volumes:
      - "${PWD}/config/app_local.yml:/app/config/app.yml"
    command: /app/starter worker
    networks:
      - starter_net

  # wallet
  wallet:
    image: jasonsoft/starter:latest
    volumes:
      - "${PWD}/config:/app/config"
    command: /app/starter wallet
    networks:
      - starter_net
      
  # event
  event:
    image: jasonsoft/starter:latest
    volumes:
      - "./config/app_local.yml:/app/config/app.yml"
    command: /app/starter event
    networks:
      - starter_net

  # frontend
  frontend:
    image: jasonsoft/starter:latest
    depends_on:
        - event
        - wallet
    ports:
      - "10080:10080"
    volumes:
      - "./config/app_local.yml:/app/config/app.yml"
    command: /app/starter frontend
    networks:
      - starter_net

networks:
  starter_net:
    external:
      name: starter_network 

      
  # event-dapr:
  #   image: "daprio/daprd:0.10.0"
  #   command: [
  #     "./daprd",
  #     "-app-id", "event",
  #     "-app-port", "10010",
  #     "-placement-host-address", "placement:50006" # Dapr's placement service can be reach via the docker DNS entry
  #     ]
  #   volumes:
  #       - "./components/:/components" # Mount our components folder for the runtime to use
  #   depends_on:
  #     - event
  #   network_mode: "service:event" # Attach the event-dapr service to the event network namespace
